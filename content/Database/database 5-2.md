این فایل در روزهای بعدی تکمیل میشود

درس اصلی select در دیتابیس بسیار مهم است 
دیتابیس آزمایشی Pubs داریم که با اسکریپت میزنیم و داخل sql server درستش میخوایم بکنیم با drag and drop یا double click روی اون فایل اسکریپت 
![[Pasted image 20241219083143.png]]

بعد execute میکنیم

![[Pasted image 20241219083258.png]]

دیتابیس pubs ساخته میشه 

حالا یه دیاگرام ERD میخوایم ببینیم که روابط بین جدوال رو بهمون نشون میده
![[{6535D8C2-5C70-456C-9EF2-46F84E264C3C}.png]]



![[Pasted image 20241219083443.png]]


![[Pasted image 20241219083421.png]]


خوب توی جدول title اسم کتاب 


![[Pasted image 20241219083617.png]]

جدول publisher میشه جدول ناشران 

![[Pasted image 20241219083710.png]]


خوب جدول titles جدول کتاب ها هستش ، tittle_id کد کتاب هستش  و tittle نام کتاب هستش مورد بعدی type هستش که از چه نوعی هستش bussines , psychology و ... ، بعدی price هستش که قیمت رو بهمون میگه   

حالا جدول publishers خوب pub_id میشه کد ناشر ، Pub_name میشه نام ناشر و sate , country هم که معلومه 

هر کتاب فقط یک ناشر داره 

![[Pasted image 20241219083818.png]]

کد نویسنده 
اسم نویسنده 
فامیلی نویسنده 

![[Pasted image 20241219083938.png]]

جدول فروش : 3 تا کلید داره و primery key شون conbinational هستش 
 اولی store_id میشه کد فروشگاه 
 دومی order_num که میشه شماره فاکتور 
 سومی میشه تاریخ فاکتور 
خوب qty میشه تعداد ای که از tittle_id فروختیم رو داره میگه 

 سوال : اگر میومدیم و primery key  رو میزاشتیم فقط tittle_id اینطوری میشد که فقط از هر کتاب یه دونه بفروشم حالا اگر tittle_id با Stor_id بود اینطوری میشد که از یه کتاب توی یه مغازه فقط یه بار میشه فروخت ، برای همین شماره فامتور رو هم به premery key ها اضافه کردیم  

![[Pasted image 20241219083918.png]]

نرم افزار جانبی red Gate رو میشه روی sql server نصب کنیم و بهمون یه سری قابلیت میده ، یکیش اینه که shortcut های خوبی بهمون میده 

بهمون نشون میده که کدوم جدول با کدوم جدول میتونه join بخوره و میتونه انجامش بده 

![[Pasted image 20241219084623.png]]

اینجا داره میگه که اگر فقط primery key مون tittle id باشه در کل این برنامه فقط یه بار میشد که کتاب sql  رو بفروشم که این میشه خطا


حالا اینجا tittle_id و Order_num رو هم در نظر میگرفتیم که اینجا هم به خطا میخوریم  

![[Pasted image 20241219084754.png]]

برای همین به این ساختار در نظرش گرفتیم :

![[Pasted image 20241219084854.png]]

یعنی تمام دیتاهایی که داخل authors هستش رو Select کن 
ستاره یا * به معنی تمام ستون ها هستش   
![[Pasted image 20241219085058.png]]


![[Pasted image 20241219085120.png]]

![[Pasted image 20241219085242.png]]

برای این که اسم گذاری بهتری انجام بدیم 

توی جول تغییری نمیکنه فقط توی اون کوئری اینطوری هستش

هر نام گذاری به جز تایپ انگلیسی رو باید داخل تک کوتیشن بنویسیم

![[Pasted image 20241219085417.png]]

یه فاصله هم بندازیم کار میکنه 

![[Pasted image 20241219085445.png]]

بهش میگن alias 

![[Pasted image 20241219085714.png]]

وقتی که نام فیلد ها در جدول ها یکی باشه باید نام اون جدول رو قبل از فیلد بزاریم که مشخص باشه که با کدوم کار داریم 

![[Pasted image 20241219085818.png]]

به طور مثال اینجا در دو جدول ما pub_id داریم مثلا وقتی که میخوایم join  بزنیم باید تعیین کنیم که منظورمون استفاده از کدومه 

![[{D7B4B96E-11B1-49F8-9959-B0E9FAD15A7C}.png]]



![[Pasted image 20241219090036.png]]

دستور use میاد اون دیتابیسی که جلوش نوشتیم رو انتخاب میکنه 

![[Pasted image 20241219090518.png]]

اینجا اروری که گرفتیم اینه که توی دیتابیس master ما authors رو نداریم 
اگر بخوایم از دوتا دیتابیس استفاده کنیم از use استفاده میکنیم  

![[Pasted image 20241219090807.png]]

خوب در عکس بالا دیتابیس انتخابی master هستش ولی چون به صورت خاص اومدیم و تعیین کردیم که توی کدوم دیتابیس چی میخوایم ، میره و دیتا رو میاره 

![[Pasted image 20241219090822.png]]
![[Pasted image 20241219090829.png]]

![[Pasted image 20241219090836.png]]

خوب schima سطوح دسترسی رو مشخص میکنه و DBO دیفالت کل دیتابیس ها هستش

![[{706A7AA5-B15B-4EFF-83F4-4F4A8FC841B9}.png]]

چون دیفالت هستش میتونیم با زدن دو تا نقطه هم به دیتابیس ها دسترسی پیدا کنیم 

و بعدش admin میاد schima های مختلف رو دسترسیش رو میده 

میتونیم schima ها رو هم تغییر بدیم 

![[{9A7E4CCE-59BA-41D3-90CD-C41137D2D137}.png]]

میتونیم schima های جدید بسازیم :
![[{F73EF5CA-B98F-464C-9169-EA29EEA45E16}.png]]

حالا اگر دیتا رو از دو تا instance جدا بیاریم 
یعنی این که وصل بشیم به یه دیتا بیس دیگه توی یه سیستم دیگه

اول باید با Sa وارد بشیم :
![[{9B96CDDD-2A68-46E4-A395-FA3A9ED72BF8}.png]]

![[Pasted image 20241219092011.png]]

![[Pasted image 20241219091800.png]]

![[Pasted image 20241219092124.png]]

اینجا تعیین میکنیم که نوع دیتابیس چیه , عکس بالا

اون سیستمی که میخوایم بهش وصل بشیم باید بهمون یه user pass از مدل Sql بهمون بده که اینجا وارد کنیم تا بتونیم بهش وصل بشیم 

نکته ای که اینجا هست اینه که اگر ما خودمون با یه یوزر windows authentication وارد شدیم اون سیستمی هم که میخوایم بهش وصل بشیم هم باید بهمون یه یوزر از همین نوع بهمون بده که بتونیم بهش وصل بشیم 


![[Pasted image 20241219092302.png]]

![[Pasted image 20241219092327.png]]

نکته ای که هست اینه که ما میتونیم به چند مدل این ارتباط و دسترسی به یه سیستم دیگه رو تعریف کنیم که به طور مثال اگر ما وقتی که توی سیستم خودمون هستیم هم با یوزر sql و هم با user windows بتونیم به اون یکی سیستم وصل بشیم :
![[{EAB4AB36-0D8D-440E-B915-91FC87C5982E}.png]]

 خوب حالا ما تعریف کردیم که user sa میتونه به اون یکی کامپیوتر وصل بشه ولی انیجا ما در حال حاضر با user adminstarator هستیم :

![[{74621CF9-2671-4FBE-A5CE-3EFF9EDCD28F}.png]]

برای همین میزنیم روی change connection   و بعد با یوزر sa وارد میشیم :
![[{2C38A21F-C0A2-4A69-8479-431DF712D15C}.png]]

![[{A560585D-CE0B-47E9-9114-D583EF95B811}.png]]

حالا برای کوئری زدن به این شکل مینویسیم 

![[Pasted image 20241219092811.png]]

اینجا قبل از زدن اسم دیتابیس میایم آدرس link server رو میزنیم 

![[Pasted image 20241219093201.png]]

![[{8953D1FD-CF98-4D81-9C03-7A0EAD930E05}.png]]
![[{83EF4A70-DBC1-43FB-8574-188E3921DF13}.png]]

سطح دسترسی native client بیشتره
توی OLE DB دستور ادمینی قبول نمیکنه و این که فقط یک یوزر برای دسترسی رو قبول میکنه 

اینجا به خاطر این که اسم به جای ip نمایش داده بشه میایم این کارو میکنیم : 

![[Pasted image 20241219093520.png]]

نکته مهم اینه که provide string برای زمانیه که بخوایم از C# به این دیتابیس وصل بشیم 


![[Pasted image 20241219093558.png]]

نکته: اینجا وقتی که تیک impersonate رو میزنیم به این معنیه که دقیقا عین همین یوزر و پسورد روی اون سیستمی هستش که میخوایم بهش وصل بشیم 

![[Pasted image 20241219093652.png]]

اگر بخوایم کتاب هایی که قیمتشون بیشتر از 20 هستش رو پیدا کنیم 

![[Pasted image 20241219102155.png]]

برای کامنت کردن از -- استفاده میکنیم، یا با /* میتونیم چند خط رو کامنت کنیم  
![[Pasted image 20241219102301.png]]

![[Pasted image 20241219102402.png]]

مخالف <>
مخالف =!
![[Pasted image 20241219102624.png]]

اگر از جنس string باشه باید از تک کوتیشن استفاده کنیم 

![[Pasted image 20241219103748.png]]

نکته همون طورکه در عکس پایین میبنید بعضی از قیمت ها null هستش ، ما برای این که به این ها دسترسی پیدا کنیم ، نمیتونیم اینطوری بنویسیم:

![[{F3AF21EE-53FC-4630-AA92-487A92B75CF4}.png]]

برای چک کردن null بودن نمیتونیم اینطوری بنویسیم:
![[{2C80FC0E-FD42-4E73-901C-C4A74751C450}.png]]

باید از is استفاده کنیم 

![[Pasted image 20241219102859.png]]

برای این که خلافش رو هم چک کنیم اینطوری ازش استفاده میکنیم :

![[Pasted image 20241219102938.png]]

![[Pasted image 20241219102950.png]]

--------------
وقتی که بخوایم از OR استفاده کنیم 
نکته ای که اینجا داریم اینه که میتونیم به جای کوئری اولی از دومی استفاده کنیم در دومی ما اومدیم و از in استفاده کردیم و با , اومدیم اسم تایپ هایی که میخوایم رو اضافه کردیم.

![[Pasted image 20241219103630.png]]

![[{F994B3C6-1653-4FAD-8400-CE29C6A61A9D}.png]]

وقتی که بخوایم از دو تا شرط رو or کنیم و کلش رو با یه شرط دیگه AND کنیم 


![[Pasted image 20241219103136.png]]

![[Pasted image 20241219103222.png]]

اینجا همونطور که میدونید دیتایی که هر کدوم از این ها برمیگردونن متفاوت هستش 

![[{BB6C9F14-1247-4A9E-8FAA-C701EF8ABD4B}.png]]

برای این که بخوایم یه مورد خاص رو پیدا کنیم هم میتونیم با = و هم میتونیم با like این کار کنیم که البته like کاربرد هایی دیگه ای هم توی سرچ کردن داره 

نکته ی خیلی مهم اینه که وقتی که برای like درصد نزاریم مثل =  عمل میکنه ولی خیلی کند تره و در دستورات و کوئرها تا جای ممکن از نوشتن like باید پرهیز کنیم 

![[Pasted image 20241219104036.png]]

![[Pasted image 20241219104131.png]]

حالا برای مواردی که اسم مثلا اون کتاب رو کامل نمیدونیم و میخوایم با بخشی از اون اسم بیایم و اون کتاب رو پیدا کنیم، برای همین از این مواردی که گفته شده استفاده میکنیم : 

این یعنی همه کتاب هایی که قسمت انتهاییشون the هستش رو برو بیار 

![[Pasted image 20241219104150.png]]

این یعنی کتابهایی رو بیار که با the شروع میشن 

![[Pasted image 20241219104212.png]]

 ![[{1A553461-EEC5-4748-A7C3-9BD8511EEF99}.png]]

این یعنی این که هر جای چه اول چه آخر چه وسط بود هر جاییش که the بود اون رو بیار

![[Pasted image 20241219104246.png]]

![[{3134B44E-93EC-4304-A122-67D6175D188F}.png]]

یه سری قابلیت های دیگه هم داره ،  مثل این که اینجا _ به معنی اینه که هر چی بود ، بود و حرف دومش e باشه و بعدش هم هر چی بود ، بود و میگه که این دیتاهارو بردار بیار 

![[Pasted image 20241219104406.png]]

![[{1542E7BF-3AAB-4F8D-9150-0257339ED4FD}.png]]

![[Pasted image 20241219104437.png]]
![[{394E5024-B76B-42F9-BD3E-E412EB705BAE}.png]]

این به معنی این هستش که اولین حرف یا m باشه یا n باشه و یا o باشه و حرف بعدیش e باشه 

![[Pasted image 20241219104505.png]]
![[{5329963F-B197-49A7-A65B-B7178580A5CC}.png]]

حالا اگر بخوایم مخالفش رو پیدا کنیم ، یعنی حرف اولش m n o نباشه و حرف بعدیش e باشه 

![[Pasted image 20241219104540.png]]

![[{81EEEC96-4671-471D-AA82-7F348B6E3E15}.png]]

به صورت بازه حرفی هم میتونیم براش تعیین کنیم ، اینجا یعنی از حرف a تا o 

![[Pasted image 20241219105100.png]]

حالا اگر بخوایم دیتا ها رو مرتب کنیم از order by  استفاده میکنیم 

![[Pasted image 20241219105208.png]]

خوب اینجا نکته ای که هستش اینه که اول میاد دیتا ها رو بر اساس au_lname میاد sort میکنه و بعد میاد در حالت هایی که مساوی شدن میاد sort شدن رو روی au_fname پیاده میکنه 

![[{19D9AAE6-0C28-496A-9BB9-2487AE84F696}.png]]

توی این قسمت به طور مثال :

![[{73E6C6C7-04A8-4BFC-9B8B-C6FEDB7CA3E6}.png]]

اینجا چون هر دو تا اسم یکسان هستند و بعدیش اومده توی فامیلی ها و sort رو بر اساس حروف الفبا تعیین کرده ، در اینجا ab بالاتر از an قرار میگیره 

میتونیم ترتیب صعودی و نزولیش رو هم تعیین کنیم 
![[Pasted image 20241219105236.png]]

میتونیم برای هر کدوم رو هم به صورت جداگانه صعودی و نزولیش رو تعیین کنیم 

![[Pasted image 20241219105419.png]]

شروع join

![[{783FC15C-C6C4-4CFD-902D-05B11E85D7D9}.png]]
https://stevestedman.com/


![[{8519D61E-F8F6-4D03-9958-44455AB5CB44}.png]]
https://blog.bytebytego.com/p/ep90-how-do-sql-joins-work

خوب اینجا فرض میکنیم که جدول سمت چپ T1 هستش و جدول سمت راست T2 
هدف این هستش که شهر هایی هر استان رو توی یک جدول ببینیم 


![[Pasted image 20241219112323.png]]

![[Pasted image 20241219112514.png]]

![[Pasted image 20241219112549.png]]

حالا اتفاقی که میوفته اینه که اول میاد از جدول استان دیتای 1 که pk هستش رو نگاه میکنه و بعد میره به جدول T2 و متناظر با اون PK دیتا رو میاره که در اینجا 1 و P هستش و همه اینها رو با هم در جدول آبی مینویسه 

حالا همنوطری که میبنید در جدول FK ما 2 تا شهر از استان b داریم برای همین هر دوتای اونها رو میاریم در جدول آبی 

نکته ای که هست اینه که در inner join دیتا هایی که در دو جدول مشترک هستند رو نشون میده  


![[Pasted image 20241219112756.png]]

حالا در left join اینطوریه که اون اشتراکات هستن + این که دیتاهایی که جدول سمت چپ هستند ولی هیچ اشتراکی با جدول سمت راست ندارند 


![[Pasted image 20241219113027.png]]

![[Pasted image 20241219113104.png]]

خوب right join میشه دیتاهای مشترک + اطلاعاتی که در جدول راست هستش

![[Pasted image 20241219113158.png]]

خوب full هم میشه همه اطلاعات 

![[Pasted image 20241219113227.png]]

![[{51ACE86B-DA2B-44EC-843F-8A376B1E1AC6}.png]]

![[Pasted image 20241219114246.png]]

![[{E2B617F8-81AF-450B-AA1C-A633BB718F65}.png]]

![[{71091F07-7FC8-46CF-A94E-442B3D585C1E}.png]]

![[{E11D1C56-CB5A-4AA7-BEDB-806864175FEE}.png]]

https://www.scaler.com/topics/cartesian-join-sql/

کوئری که نام کتاب و نام ناشر کتاب ها رو لیست کنه :
![[{1E809D56-24AD-4875-82F5-05F95F466DCD}.png]]
بعد از این که اسم جدول ها رو به t و p تغییر دادیم میایم select مون رو تغییر میدیم 
میایم از نام های alias استفاده میکنیم تا بعدا بدونیم که مثلا title از t اومده که t هم میشه alias جدول titles یا pub_name از p اومده که p میشه alias جدول publishers

![[Pasted image 20241219120648.png]]

حالا اینجا اگر left join بزنیم تمام کتاب ها رو میاریم حتی اون هایی که هیچ ناشری ندارند 

خوب تعداد این left join با تعداد inner join یکی هستش که این نتیجه رو میده که تمامی کتاب ها حتما ناشر دارند ، هر دو 18 تا دارند 
![[{FE82636F-4278-4899-AA5C-5FC71D8D2D81}.png]]

اگر right join بزنیم تمام ناشرها رو میاره حتی اون هایی که هیچ کتابری رو منتشر نکردن
تعدادش 23 تاست 

![[{190E37B2-699B-4493-BE14-3B77E1327E00}.png]]

![[Pasted image 20241219120848.png]]

نتیجه ی full join 

![[{2D38F0F1-1FE9-4132-BBF6-AA4DE5AC4046}.png]]
 
 
 خوب طبق علائم بینهایت و کلید همونطور که میبینید 
 از سمت titles میشه چند به 1 و از publishers میشه یک به چند 

![[Pasted image 20241219121219.png]]

کوئری میخوایم که ناشرینی رو لیست کنه که هیچ کتابی رو منتشر نکردن 

اینجا همونطور که میبینید اگر بیایم از where استفاده کنیم و بگیم که کتاب هایی که قیمتشون null رو بیار برای این که به هدفمون برسیم اشتباهه ، چون که درسته که تمامی فیلد ها برای ناشر هایی که کتاب منتشر نکردن ، در سمت چپ null هستش ولی اتفاقی که افتاده اینه که یه سری کتابی هم که چاپ شدن قیمتشون null هستش 

برای این بخوایم وجود یا عدم جود چیزی رو در جدوال چک کنیم باید از PK استفاده کنیم، که در اینجا میشه title_id 

![[{3A9C90EE-2E31-42A6-9CC7-9FDBAB39FEC1}.png]]

این درسته :

![[{B07C6C61-D16B-4A17-BD3F-CCC79D1FE76A}.png]]

همیشه  تمامی جداول PK اشون مخالف null هستن و اگر در جایی مثل join ها وقتی که دیدمشون که null هستن ، این به این معنیه که اون ها اصلا وجود ندارن 

کوئری که نام و نام خانوادگی نویسنده و نام کتاب هایی که نوشته رو لیست کنیم 

![[{EA9405DC-82FF-4A4E-A938-0CCB431298F8}.png]]

اینجا ما چون رابطه چند به چند داریم نیاز به یه جدول واسط داریم ،
اینجا یک کتاب میتونه چندین تا نویسنده داشته باشه و یک نویسنده میتونه چندین تا کتاب داشته باشه 

![[{7804E830-EBF2-44E6-BF16-9F9C1E5CEA4E}.png]]

اینجا ما یه طور مثال یک نفر رو داریم که دو تا کتاب رو چاپ کرده یعنی کتاب هایی با tittle_d این ها BU1032 , bu2075 و به این شکل هم نمایش داده شده   

حالا نتیجه ی کوئری دومی میشه این :
![[{5D9A98BD-34DA-47C7-8CB0-BE0868A1F278}.png]] 

در این جا کتاب bu1032 چون توسط دو نفر نوشته شده پس در دو جا اومده  

![[{13680668-448D-4629-A5B1-D43BCC7353AB}.png]]

اینجا اومدیم جدول authors  رو به جدول واسط join کردیم 

![[{8AA2400D-4567-4973-85BA-4DBFFAB4661D}.png]]

