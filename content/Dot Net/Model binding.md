این قابلیت به این شکل انجام میشه که میاد دیتایی که از سمت client میاد به سمت سرور رو که به شکل string هستش رو میگیره و میتونه دسته بندی روش انجام بده یا convert اش کنه و اون مدل data type که میخوایم رو بهمون میده 

دقت داشته باشید که model binding میاد و درخواست ما رو میگیره تحلیل میکنه و میگرده و بعد وصلش میکنه به جایی که باید کار کنه 

![[Pasted image 20241207213052.png]]

![[Pasted image 20241207213058.png]]

![[Pasted image 20241207213103.png]]
خوب model binding asp .net میاد در 5 جای مختلف میگرده دنبال دیتای ما 
اگر کاربر دیتا رو به یکی از این مکان ها ارسال کرده باشه اون رو میگیره و میبره توی اون متغییر ها میزاره تا ازشون استفاده کنیم 

![[Pasted image 20241207213115.png]]

خوب اگر درخواستمون get باشه از 1 و 2 استفاده میشه 
اگر post باشه توی 1 و 2 و 3 میگرده 
ولی برای دو مورد آخر باید خودمون بیایم ستاپ کنیم که بره دیتا رو چجوری بخونه و چی کار کنه 

![[Pasted image 20241207213132.png]]

![[Pasted image 20241207213139.png]]

خوب اینجا میبینید که پارامتر name خالی و null هستش ، چرا؟ چون که خوده فریمورک رفته گشته توی اون مورد های 1 و 2 و 3 ولی پیدا نکردتش 
درسته که ما با پستمن دیتا رو داریم توی هدر میفرستیم ولی فریمورک توی هدر رو نگاه نمیکنه و ما باید خودمون براش تعیین کنیم 


![[Pasted image 20241207213151.png]]

ولی اینجا وقتی که با کوئری استرینگ میفرستیم دریافتش میکنه

![[Pasted image 20241207213212.png]]

خوب ما اینجا داریم توی 3 مکان مختلف name رو ارسال میکنیم 
یکی توی route هستش که babei 
یکی توی query string هستس که ehsan 
یکی هم توی header هستش 

![[Pasted image 20241207213236.png]]

![[Pasted image 20241207213242.png]]

اول route چک میشه و اگر پیدا نکرد میره توی query string 
حالا اگر بخوایم دیتا رو از header بخویم میام این کار رو میکنیم :

![[Pasted image 20241207213256.png]]

اینجا باگتو رو دریافت میکنیم 
میتونیم هم برای این که سریع تر پیدا ککنده خوده model binding دات نت اینطوری بنویسیم اینطوری دیگه route چک نمیشه 

![[Pasted image 20241207213309.png]]


خوب در این حالت هر دو نام ها باید با هم یکسان باشند 
ولی اگر قراره متفاوت باشند این کار رو میکنیم  :

![[{9A9F0E31-AD69-48D5-B3F7-28E3E6FA3B94}.png]]

![[Pasted image 20241207213330.png]]

اینجا از سمت client با person name میاد و بعد میاد توی full name در سمت بک اند قرار میگیره 

حالا میخوایم طبق چیزهایی که توی این کلاس تعریف شده بیایم و از client دیتا رو بگیریم 

![[Pasted image 20241207213348.png]]

![[Pasted image 20241207213354.png]]

![[Pasted image 20241207213400.png]]

![[Pasted image 20241207213407.png]]



خوب اینجا چرا user id صفر هستش؟ 
دلیلش اینه که وقتی که دیتا رو از سمت client میفرستیم سمت سرور ، توی سرور میاد و اگر نتونه پیداش کنه مقدار دیفالت براش میزاره 
چون ما اومدیم user id رو در header گذاشتیم و بهش نگفتیم که user id توی header هستش پس در نتیجه صفر به ما میده

حالا میایم و توی route براش userid رو میفرستیم 

![[{3EEFAEAC-E1A2-4372-87F0-7672B60B15BA}.png]]


![[{23922EB8-8B87-4CBE-AA35-C1D2A65551BB}.png]]

حالا نکته ای که هست اینه که اگر ما بفرستیم ولی نتونه convert اش کنه باز هم مقدار دیفالت براش میزاره 

![[Pasted image 20241207213428.png]]

اینجا به جای این که به user id که از نوع عددی هستش بهش string دادیم و فرستادم و سمت سرور چون نمیتونه که convert اش کنه میاد مقدار دیفالت میزاره که میشه همون صفر 


وقتی که دیتایی رو از سمت کلاینت به سرور میفرستیم  به صورت string دریافت میشه  و وقتی که model binding اون رو دریافت میکنه بر اساس اون دیتا تایپ ها که براشون تعیین کردیم میاد و تبدیل رو انجام میده به صورت مثال میاد 20 رو که به صورت string هستش رو به int تبدیل میکنه 

خوب حالا با استفاده از attribute میتونیم براش مشخص کنیم که کجا بره دنبالش 

![[Pasted image 20241207213443.png]]

اینجوری ارسالش میکنیم 

![[Pasted image 20241207213455.png]]

![[{58A271B9-7F72-4CF0-9A9E-6C938C5E83B8}.png]]

خوب حالا این رو در نظر بگیرید که client میتونه user و user id رو اگر بتونه خودش بفرسته سمت سرور و بعد بتونه اطلاعات اون  یوزر رو ویرایش میتونه بکنه که این قابل قبول نیست 
روش برای جلوگیری اینه  که dto های مختلف بنویسیم 

   توی home controller 
خوب حالا این رو در نظر بگیرید که client میتونه user و user id رو اگر بتونه خودش بفرسته سمت سرور و بعد بتونه اطلاعات اون رو یوزر رو ویرایش میتونه بکنه که این قابل قبول نیست 
روش برای جلوگیری اینه  که dto های مختلف بنویسیم 

   توی home controller 
![[Pasted image 20241207213509.png]]


بعد همونجا میایم و برای اکشنش از اون کلاسی که تعریف کردیم که میاد اطلاعات رو بر اساس UserInfoDto  میگیره 
نکته این که ما اومدیم اینجا اون کلاس رو new کردیم ولی در صورتی که درستش اینه که از di استفاده کنیم 


![[Pasted image 20241207213538.png]]

ولی این کار هایی که در بالا کردیم درست نیست و باید یه dto برای دریافت دیتا از سمت کلاینت درست کنیم یکی برای دریافت اطلاعات در سمت سرور درست کنیم - به این شکل :

![[Pasted image 20241207213552.png]]


خوب میدونیم که userInfoDto توی سرویسمون داره استفاده میشه 

![[Pasted image 20241207213509.png]]

و user info Client Dto رو هم میبریم سمت  user و اینتطوری ازش استفاده میکنیم :

اینطوری user فقط میتونه name و last name و token رو ارسال کنه و نمیتونه دیگه user id رو ارسال کنه  

![[{E85EBF62-824C-41C1-84AA-66BD44920961}.png]]

حالا اگر در سمت کلاینت و سرور بخوایم از یک DTO استفاده کنیم :

![[{6C718AB5-0FB4-45A3-A0C5-81331D2FACEA}.png]]

حالا یه راهی که بتونیم جلوی این که کلاینت نتونه userid رو بفرسته اینه که این کار رو کنیم :

![[{06AB27B7-A12D-4B74-83B2-E0DC20EAF2C1}.png]]

یا این کار رو کنیم :
![[{A64178F4-CA1F-4E0A-A1DC-4B736A1B8877}.png]]
خوب در نظر بگیرید که اگر برای متدی که post هستش بیایم و get بزنیم 

![[{995FFDC5-6D08-4042-8B16-0A1936B18234}.png]]

![[{6A79CC24-91FD-41CD-B64F-21836B5407F8}.png]]

این ارور رو میگیریم 

حالا اگر از post استفاده کنیم خالی ارسال کنیم 

![[{E7A78A05-5668-4A13-8762-7497E4E67040}.png]]

![[{7381E2FD-D5B4-4397-9AC6-003F02D8BC25}.png]]

حالا همین قضیه رو توی api میریم تست کنیم اگر برای یه Route بیایم و اطلاعاتی غیر از اون چیزی که میخواد رو ارسال کنیم چی میشه ؟

![[{D2A2FD4B-9EFD-41F3-804D-CE2DD74735D3}.png]]


![[{C10EB414-E034-43CE-83C2-C1AFC8A67D8F}.png]]

توی query string میزنیم 

![[{775D1C8B-CA84-4072-B2BD-16B7EB3B083A}.png]]

![[{AEAB1E98-2302-4CD9-82DF-8E841C4666FC}.png]]
خوب حالا میایم به صورت json دیتا براش میفرستیم
![[{597016F9-3499-4E97-AB6E-D88D177863C4}.png]]
اینجا درست انجام میشه و ارور نمیده 
![[{AD56A25F-E581-44CF-B2AD-77E31DDF42B2}.png]]

این رو یادمون باشه که در جاهایی که از اتریبیوت api Controller داره استفاده میشه اگر هم دیتا رو به صورت کامل از اون چیزی که میخواد ارسال کنیم باز هم کار میکنه :

![[{1055AE4C-2D83-40BE-82A8-6FAB0C638AA2}.png]]

حالا اگر بیایم و بگیم دیتا رو از query فقط دریافت کن جی؟
![[{085F5C7B-8D49-46B2-8FD5-2DF00D775210}.png]]

باز هم دریافت میکنه وقتی که به شکل json در body ارسالش میکنیم 

حالا توی این حالت هم از query بفرستیم و هم از json اینجا میاد اونی که توی query  هستش رو دریافت میکنه 
![[{D9DC240E-BE10-46C3-9585-CA6F44271E1D}.png]]

![[{E4995934-D59C-44D8-A2EA-06ADAA67B9F8}.png]]


اگر چیزی رو بفرستیم و نتونه convert اش کنه اگر اون تای
 مقدار دیفالت داشته باشه اون رو میزاره و اگر نداشته باشه nulll میزاره 
 این دیتا تایپ ها رو asp ساپورت میکنه 
![[Pasted image 20241217195311.png]]

 همه ی این ها به صوت string ارسال میشن 
  اگر  هم نخوایم model bonding بخواد کاری برامون انجام بده ، میتونیم اون دیتاتای
   رو براش غیر فعال کنیم 
خوب حالا با این دستور دیگه bool تبدیل روش انجام نمیشه :

![[Pasted image 20241217195326.png]]

خوب میایم توی home controller این ها رو درست میکنیم 

![[Pasted image 20241217195345.png]]

خوب اینجا اومدیم با استفاده از tag helper ها اون چیزی که قراره توی model binding فریم ورک اون رو بگیره رو تعیین کردیم :

![[Pasted image 20241217195359.png]]

مثلا user . name 

اولویت برای پیدا کردن دیتا ها با اون اسمی هستش که براش تعیین کردیم که در اینجا میشه user 

![[Pasted image 20241217195453.png]]

خوب حالا فکر کنید که میخوایم دو تا اطلاعات متفاوت رو ارسال کنیم :

![[Pasted image 20241217195508.png]]

![[Pasted image 20241217195521.png]]

![[Pasted image 20241217195524.png]]

اینجا میبینید که null هستش info 
برای همین قضیه باید اینطوری عمل کنیم :

![[Pasted image 20241217195534.png]]

اینطوری به صورت nested میتونیم بهش دسترسی پیدا کنیم 

![[Pasted image 20241217195544.png]]

خوب حالا یه راه دیگه :
![[Pasted image 20241217195557.png]]
اینطوری هم میتونیم بهش دسترسی پیدا کنیم
یه راه دیگه هم داریم : 

![[Pasted image 20241217195606.png]]

![[Pasted image 20241217195609.png]]



![[Pasted image 20241217195617.png]]


خوب فرض کنید که 3 تا چک باکس داریم 
![[{CB4222DA-20C6-437E-BD9C-5A9EA686C4F0}.png]]

میخوایم اطلاعاتی که یوزر توی این 3 تا میزنه رو بفرستیم سمت سرور 
برای این کار name تمامی کنترلر هامون باید یکی باشه 
اسم همه رو گذاشتیم ch 
![[{3C491BB3-887B-4F2A-8917-03151126B272}.png]]

حالا میریم توی home controller و این کار رو میکنیم :
![[{45DE80DC-2139-4566-8256-FAFE2F0C41DA}.png]]
حالا دوتاش رو تیک میزنیم 
![[{0DAF25B5-960C-48ED-9DF4-31C60EDED6B1}.png]]
![[{5C485AB7-F227-42CF-BCFF-EA873979649C}.png]]

اینجا نمیتونیم تشخیص بدیک که کدومشون تیک خورده ، تنها چیزی که متوجه میشیم اینه که دوتاشون تیک خورده 

این هم یه راه دیگه :

![[{C9C0BFC3-B7BB-4B89-91A8-00CEAB6CE18A}.png]]
خوب حالا میایم و براش اندیس تعیین میکنیم :

![[{301AB33B-5628-44D0-8C6E-E22068D5867D}.png]]

![[{0FD10588-FD7E-4D63-AEEF-287961DF93D4}.png]]



![[{3ABF615C-B386-45D7-BD9C-0E2015E809C5}.png]]
از طریق IFormCollection هم میتونیم : 

![[{630FE753-1775-49FB-B8F5-1C4D3B61C0EF}.png]]

 میایم به اون فرم های که قبلا نوشتیم این رو هم اضافه میکنیم :
 ![[{4AD933F9-B977-4D8F-B4CA-5C0C161AB362}.png]]
  ![[{7C71E042-3216-4FB7-A450-7CD4132814BF}.png]]
![[{DA0F645B-FC4A-4826-81BC-C239FDD9B2BE}.png]]

همه ی اطلاعاتی که داخل فرم ها هستش برای ما ارسال میشه 

یه راه دیگه هم استفاده از IFormFile استفاده میکنیم :
![[{A4E8EF20-FEDD-434B-94C5-0EA157EC7927} 1.png]]


![[{AC54E759-A1EB-4F02-B4CB-51345C4351CB}.png]]

یه تغییر دیگه رو هم باید اعمال کنیم 
![[{596230AB-2FF7-4276-85A9-E25A300EFFB9}.png]]

بیایم و enctype رو بزاریم روی multipart/form-data

![[{6EE9C62C-F4A3-4F1D-AC01-485D2BE8878C}.png]]

![[{0F5D53CC-B9F5-46FB-8918-B12BB8E80D87}.png]]

اگر چند تا هم فایل داشتیم از این استفاده میکنیم :
![[{5B5FE7F7-189C-442E-8DB9-754337AF9EEF}.png]]

خوب حالا اگر ما یه سرویس داشته باشیم، اول اومدیم اینترفیسش رو تعریف کردیم و بعد اومدیم یه کلاس دیگه تعریف کردیم که از این اینترفیس ارث بری میکنه بنابراین باید اون متدی که داخل اینترفیس هستش رو پیاده سازی کنیم  
![[{4472F409-5495-4473-BBCB-B99403C33964}.png]]


بعد میریم توی فایل Starup میایم و از AddTransient استفاده میکنیم و به سرویس هامون اضافه اش میکنیم 

![[{DC1F5C18-E12A-4EE3-9E82-5FAF056572B0}.png]]

و به جای تزریق وابستگی میتونیم ازش اینطوری استفاده کنیم ، با استفاده از FromService  
![[{F947D315-928E-4B31-BA38-568186B37646}.png]]

با استفاده از model binding میتونیم تزریق وابستگی رو هم انجام بدیم 

![[Pasted image 20241220165319.png]]


تمامی دیتاهایی که از سمت کلاینت به سمت سرور میره با فرمت json ارسال میشه و ما میتونیم این فرمت رو تغییر بدیم :

برای تغییر اول باید پکیج اون فرمت دلخواهمون رو از ناگت بگیریم 
اینجا از json میخوایم تغییر بدیم به xml 
 
![[Pasted image 20241220165530.png]]


میریم در فایل  startup و این کارو میکنیم :
![[Pasted image 20241220165632.png]]

در کنترلر هم میام از این attribute استفاده میکنیم 
![[Pasted image 20241220165716.png]]


![[Pasted image 20241220165906.png]]

در مواقعی که بخوایم model binder رو به صورت اتختصاصی برای خودمون درست کنیم این کاراها رو میکنه :

  به طور مثال میخوایم با این فرمت دیتا رو دریافت کنیم 
  ![[Pasted image 20241221174200.png]]

خوب حالا اگر بخوایم این کارو بکنیم باید بیایم یه کلاس جدا درست کنیم و بعد بیایم از اینترفیس IModelBinder ارث بری کنیم 
![[Pasted image 20241221174419.png]]

برای پارامتر ورودی میاد اون دیتایی که از ورودی میاد رو توی bindingContext میگیره یا از سمت کلاینت براش ارسال میکنیم 

بعد میایم کلاس یوزر رو مینویسیم:

![[Pasted image 20241221211808.png]]

![[Pasted image 20241221214148.png]]

```csharp
public class UserCustomModelBinder : IModelBinder  
{  
    public Task BindModelAsync(ModelBindingContext bindingContext)  
    
    {       
     if (bindingContext == null)  
        {          
           throw new ArgumentNullException(nameof(bindingContext));  
        }       
        
		 var values =bindingContext.ValueProvider.GetValue("User");  
  
        if (values.Length == 0)  
        {  
                  return Task.CompletedTask;  
        }  
        var splitData = values.FirstValue.Split('|');  
        if (splitData.Length >= 3)  
        {         
           User user = new User()  
            {  
                Id = int.Parse(splitData[0]),  
                Name = splitData[1],  
                LastName = splitData[2],  
 };  
            bindingContext.Result = ModelBindingResult.Success(user);  
        }      
          return Task.CompletedTask;  
            }  
}
```

برای توضیح کد بالا :
![[Pasted image 20241221212723.png]]

مورد بعدی 
![[Pasted image 20241221212905.png]]

اینجا ما key رو user در نظر گرفتیم ، این یعنی این که از سمت کلاینت باید با کلید user اون string رو دریافت کنیم :
![[Pasted image 20241221213010.png]]
اگر تغییرش بدیم به UserN باید از سمت کلاینت هم با همین کلید ارسالش کنیم 

![[Pasted image 20241221213131.png]]
![[Pasted image 20241221213142.png]]

مورد بعدی 
![[Pasted image 20241221213250.png]]


```csharp
public IActionResult NewUser([ModelBinder(binderType:typeof(UserCustomModelBinder))]User newUser)  
{  
    return View();  
}
```

برای استفاده ازش در controller هم اینطوری ازش استفاده میکنیم 

![[Pasted image 20241221213347.png]]

![[Pasted image 20241221221424.png]]

https://www.dotnetcurry.com/aspnet-mvc/1368/aspnet-core-mvc-custom-model-binding
